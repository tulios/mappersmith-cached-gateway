/*! MappersmithCachedGateway - https://github.com/tulios/mappersmith-cached-gateway - Generated by browserify */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.MappersmithCachedGateway=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports={CacheStore:require("./src/cache-store"),LocalStorageCacheStore:require("./src/local-storage-cache-store"),SessionStorageCacheStore:require("./src/session-storage-cache-store"),createCachedGateway:require("./src/create-cached-gateway"),createCacheStore:require("./src/create-cache-store")}},{"./src/cache-store":2,"./src/create-cache-store":3,"./src/create-cached-gateway":4,"./src/local-storage-cache-store":5,"./src/session-storage-cache-store":6}],2:[function(require,module,exports){(function(global){var Utils=("undefined"!=typeof window?window.Mappersmith:"undefined"!=typeof global?global.Mappersmith:null).Utils,CacheStore=function(opts){this.options=Utils.extend({},opts),this.namespace=this.options.namespace||"mappersmith_cache",this.namespaceRegex=new RegExp("^"+this.namespace+":"),this.ttl=this.options.ttl||300,this.disableCache=this.options.disableCache||!1};CacheStore.prototype={cacheKey:function(name){return this.isCacheKey(name)?name:this.namespace+":"+name},isCacheKey:function(name){return this.namespaceRegex.test(name)},resolveTTL:function(opts){var options=Utils.extend({ttl:this.ttl},opts),ttl=parseFloat(options.ttl,10);return isNaN(ttl)&&(ttl=this.ttl),ttl},fetch:function(name,opts){var gateway=opts.gatewayInstance,cacheOpts=Utils.extend({},opts.cacheOpts);return this.disableCache||cacheOpts.disableCache?void opts.request():void this.read(name,function(data){if(null===data){var hasProcessor=void 0!==gateway.processor,originalProcessor=gateway.processor||function(data){return data},wrappedProcessor=function(newData){var args=[name,newData,cacheOpts];return opts.writeCallback&&args.push(opts.writeCallback),this.write.apply(this,args),originalProcessor(newData)}.bind(this);gateway.processor=wrappedProcessor,hasProcessor||gateway.success(gateway.successCallback),opts.request()}else gateway.successCallback(data,{cacheHit:!0})}.bind(this))},read:function(name,callback){throw new Utils.Exception("CacheStore#read not implemented")},write:function(name,data,opts,doneCallback){throw new Utils.Exception("CacheStore#write not implemented")},delete:function(name,doneCallback){throw new Utils.Exception("CacheStore#delete not implemented")},cleanup:function(doneCallback){throw new Utils.Exception("CacheStore#cleanup not implemented")},clear:function(doneCallback){throw new Utils.Exception("CacheStore#clear not implemented")}},module.exports=CacheStore}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(require,module,exports){(function(global){var Mappersmith="undefined"!=typeof window?window.Mappersmith:"undefined"!=typeof global?global.Mappersmith:null,Utils=Mappersmith.Utils,CacheStore=require("./cache-store");module.exports=function(methods){var newCacheStore=function(){CacheStore.apply(this,arguments),this.init&&this.init()};return newCacheStore.prototype=Utils.extend({},CacheStore.prototype,methods),newCacheStore}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./cache-store":2}],4:[function(require,module,exports){(function(global){var Mappersmith="undefined"!=typeof window?window.Mappersmith:"undefined"!=typeof global?global.Mappersmith:null,Utils=Mappersmith.Utils,LocalStorageCacheStore=require("./local-storage-cache-store");module.exports=function(TransportGateway,CacheStore,cacheStoreOpts){"object"==typeof TransportGateway?(cacheStoreOpts=TransportGateway,TransportGateway=void 0):"object"==typeof CacheStore&&(cacheStoreOpts=CacheStore,CacheStore=void 0),TransportGateway=TransportGateway||Mappersmith.VanillaGateway,CacheStore=CacheStore||LocalStorageCacheStore,cacheStoreOpts=Utils.extend({},cacheStoreOpts);var store=new CacheStore(cacheStoreOpts),GatewayClass=Mappersmith.createGateway(Utils.extend({},TransportGateway.prototype,{get:function(){var cacheOpts=Utils.extend({},this.opts.cache);store.fetch(this.url,{request:function(){TransportGateway.prototype.get.apply(this)}.bind(this),gatewayInstance:this,cacheOpts:cacheOpts})}}));return GatewayClass.cacheStore=store,GatewayClass}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./local-storage-cache-store":5}],5:[function(require,module,exports){(function(global){var CreateCacheStore=(("undefined"!=typeof window?window.Mappersmith:"undefined"!=typeof global?global.Mappersmith:null).Utils,require("./create-cache-store")),LocalStorageCacheStore=CreateCacheStore({init:function(){this.storage=window.localStorage},read:function(name,callback){this._async(function(){var data=this._syncRead(name);return null==data?callback(null):void(data.ttl<Date.now()?(this.delete(name),callback(null)):callback(data.value))})},write:function(name,data,opts,doneCallback){"function"==typeof opts&&(doneCallback=opts,opts={}),this._async(function(){this._syncWrite(name,data,opts),doneCallback&&doneCallback()})},delete:function(name,doneCallback){this._async(function(){this._syncDelete(name),doneCallback&&doneCallback()})},cleanup:function(doneCallback){this._async(function(){this._eachCacheKey(function(cacheKey){var data=this._syncRead(cacheKey);data.ttl<Date.now()&&this._syncDelete(cacheKey)}),doneCallback&&doneCallback()})},clear:function(doneCallback){this._async(function(){this._eachCacheKey(function(cacheKey){this._syncDelete(cacheKey)}),doneCallback&&doneCallback()})},_syncDelete:function(name){var cacheKey=this.cacheKey(name);this.storage.removeItem(cacheKey)},_syncRead:function(name){var cacheKey=this.cacheKey(name),rawData=this.storage.getItem(cacheKey);return null==rawData?null:JSON.parse(rawData)},_syncWrite:function(name,data,opts){var cacheKey=this.cacheKey(name),ttlInSeconds=this.resolveTTL(opts),ttl=this._convertToDate(ttlInSeconds);this.storage.setItem(cacheKey,JSON.stringify({ttl:ttl,value:data}))},_eachCacheKey:function(eachCallback){Object.keys(this.storage).filter(function(key){return this.isCacheKey(key)}.bind(this)).forEach(eachCallback.bind(this))},_convertToDate:function(ttlInSeconds){return Date.now()+1e3*ttlInSeconds},_async:function(callback){setTimeout(function(){callback.apply(this)}.bind(this),1)}});module.exports=LocalStorageCacheStore}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./create-cache-store":3}],6:[function(require,module,exports){(function(global){var Utils=("undefined"!=typeof window?window.Mappersmith:"undefined"!=typeof global?global.Mappersmith:null).Utils,LocalStorageCacheStore=require("./local-storage-cache-store"),CreateCacheStore=require("./create-cache-store"),SessionStorageCacheStore=CreateCacheStore(Utils.extend({},LocalStorageCacheStore.prototype,{init:function(){this.storage=window.sessionStorage}}));module.exports=SessionStorageCacheStore}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./create-cache-store":3,"./local-storage-cache-store":5}]},{},[1])(1)});